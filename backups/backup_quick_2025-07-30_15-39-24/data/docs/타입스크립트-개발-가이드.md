# TypeScript 개발 가이드

## 🎯 목적

이 가이드는 Awarefit-CRM 프로젝트에서 TypeScript 개발 시 발생할 수 있는 타입 오류들을 사전에 방지하고, 일관된 개발 방식을 유지하기 위해 작성되었습니다.

## 🔧 개발 환경 설정

### 1. 필수 확장 프로그램 (VSCode)

```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-json"
  ]
}
```

### 2. VSCode 설정

```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  },
  "typescript.preferences.removeUnusedImports": true,
  "eslint.validate": ["typescript", "typescriptreact"]
}
```

## 📝 타입 정의 베스트 프랙티스

### 1. Optional vs Nullable 타입 일관성

**❌ 잘못된 예:**
```typescript
interface User {
  name: string;
  email?: string;  // 때로는 undefined
  phone: string | null;  // 때로는 null
  address?: string | null;  // 혼재된 사용
}
```

**✅ 올바른 예:**
```typescript
interface User {
  name: string;
  email?: string | null;  // 일관된 nullable 타입
  phone?: string | null;
  address?: string | null;
}
```

### 2. 유틸리티 함수 활용

```typescript
// utils/memberUtils.ts에서 제공하는 함수들 사용
import { calculateAge, formatPhoneNumber, isValidEmail } from '../utils/memberUtils';

// ❌ 직접 구현하지 말고
const age = member.birth_date ? new Date().getFullYear() - new Date(member.birth_date).getFullYear() : null;

// ✅ 유틸리티 함수 사용
const age = calculateAge(member.birth_date);
```

### 3. 인터페이스 확장 패턴

```typescript
// 기본 인터페이스
interface BaseMember {
  id: number;
  name: string;
  // ...
}

// 확장된 인터페이스
interface MemberDetail extends BaseMember {
  age?: number;
  currentMembership?: ExtendedMembershipHistory;
  // ...
}

// 생성용 타입 (Omit 활용)
type CreateMemberInput = Omit<BaseMember, 'id' | 'created_at' | 'updated_at'>;
```

## 🚫 자주 발생하는 오류와 해결책

### 1. 사용하지 않는 Import 오류

**문제:**
```typescript
import React, { useState, useEffect } from 'react';
import { Camera, Heart, Upload } from 'lucide-react'; // 사용하지 않는 import들
```

**해결책:**
- ESLint가 자동으로 감지하고 수정
- `npm run lint:fix` 명령어로 자동 수정
- VSCode에서 저장 시 자동 정리 설정

### 2. Null/Undefined 안전성

**문제:**
```typescript
const age = calculateAge(member.birth_date); // number | null
const detail: MemberDetail = {
  ...member,
  age: age // Type 'number | null' is not assignable to type 'number | undefined'
};
```

**해결책:**
```typescript
const age = calculateAge(member.birth_date); // number | undefined (일관된 타입)
const detail: MemberDetail = {
  ...member,
  age: age ?? undefined, // 명시적 변환
};
```

### 3. 타입 가드 활용

```typescript
// ❌ 타입 단언 남용
const member = data as Member;

// ✅ 타입 가드 사용
function isMember(data: any): data is Member {
  return data && typeof data.id === 'number' && typeof data.name === 'string';
}

if (isMember(data)) {
  // data는 이제 Member 타입으로 안전하게 사용 가능
}
```

## 🔍 개발 워크플로우

### 1. 개발 시작 전

```bash
# 타입 체크 실행
npm run type-check

# 린팅 실행
npm run lint

# 전체 체크
npm run check-all
```

### 2. 개발 중

```bash
# 실시간 타입 체크
npm run type-check:watch

# 실시간 린팅 (별도 터미널)
npm run lint:watch
```

### 3. 커밋 전

```bash
# 코드 포맷팅
npm run format

# 전체 체크
npm run check-all
```

## 📚 권장 패턴

### 1. 에러 핸들링

```typescript
import { safeExecute } from '../utils/memberUtils';

// ❌ try-catch 반복
try {
  const age = calculateAge(birthDate);
  return age;
} catch {
  return undefined;
}

// ✅ 유틸리티 함수 활용
const age = safeExecute(() => calculateAge(birthDate), undefined);
```

### 2. 디바운스 패턴

```typescript
import { debounce } from '../utils/memberUtils';

// 검색 입력 디바운스
const debouncedSearch = useCallback(
  debounce((value: string) => {
    onFilterChange({ ...filter, search: value });
  }, 300),
  [filter, onFilterChange]
);
```

### 3. 데이터 변환

```typescript
import { sanitizeMemberData, createMemberDetail } from '../utils/memberUtils';

// DB에서 가져온 데이터 정제
const members = rawData.map(sanitizeMemberData);

// 상세 정보 객체 생성
const memberDetail = createMemberDetail(member, {
  currentMembership: membership,
  visitCount: 10,
});
```

## 🎨 컴포넌트 작성 가이드

### 1. Props 인터페이스

```typescript
interface MemberCardProps {
  member: Member;
  onEdit: (member: Member) => void;
  onDelete: (member: Member) => void;
  className?: string;
}

const MemberCard: React.FC<MemberCardProps> = ({
  member,
  onEdit,
  onDelete,
  className = '',
}) => {
  // 컴포넌트 구현
};
```

### 2. 상태 관리

```typescript
// ❌ any 타입 사용
const [data, setData] = useState<any>({});

// ✅ 명시적 타입 정의
const [memberDetail, setMemberDetail] = useState<MemberDetail | null>(null);
const [loading, setLoading] = useState<boolean>(false);
const [errors, setErrors] = useState<Record<string, string>>({});
```

### 3. 이벤트 핸들러

```typescript
// ❌ 타입 없는 핸들러
const handleSubmit = (e) => {
  // ...
};

// ✅ 타입이 있는 핸들러
const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {
  e.preventDefault();
  // ...
};

const handleInputChange = (field: keyof CreateMemberInput, value: string) => {
  // ...
};
```

## 🚀 성능 최적화

### 1. 메모이제이션

```typescript
const memoizedStats = useMemo(() => {
  return calculateMemberStats(members);
}, [members]);

const memoizedFilteredMembers = useMemo(() => {
  return filterMembers(members, searchTerm);
}, [members, searchTerm]);
```

### 2. 콜백 최적화

```typescript
const handleFilterChange = useCallback((filter: MemberSearchFilter) => {
  setSearchFilter(filter);
  setPagination(prev => ({ ...prev, page: 1 }));
}, []);
```

## 📋 체크리스트

### 새로운 컴포넌트 생성 시

- [ ] Props 인터페이스 정의
- [ ] 적절한 타입 import
- [ ] 유틸리티 함수 활용
- [ ] 에러 핸들링 구현
- [ ] 로딩 상태 관리
- [ ] 접근성 고려 (a11y)

### 기존 컴포넌트 수정 시

- [ ] 타입 체크 실행
- [ ] 사용하지 않는 import 제거
- [ ] 린팅 규칙 준수
- [ ] 테스트 업데이트 (있는 경우)

### 커밋 전

- [ ] `npm run check-all` 통과
- [ ] 기능 테스트 완료
- [ ] 코드 리뷰 요청

## 🆘 트러블슈팅

### 일반적인 오류 해결

1. **"is declared but its value is never read"**
   - 사용하지 않는 import나 변수 제거
   - `npm run lint:fix` 실행

2. **"Type 'null' is not assignable to type 'undefined'"**
   - 타입 정의 일관성 확인
   - `?.` 연산자나 `??` 연산자 활용

3. **"Cannot find module"**
   - import 경로 확인
   - 파일 존재 여부 확인
   - tsconfig.json의 paths 설정 확인

### 도움이 되는 명령어

```bash
# 타입 에러만 확인
npm run type-check

# 자동 수정 가능한 린트 에러 수정
npm run lint:fix

# 코드 포맷팅
npm run format

# 전체 검사
npm run check-all
```

## 🔗 추가 자료

- [TypeScript 공식 문서](https://www.typescriptlang.org/docs/)
- [React TypeScript 가이드](https://react-typescript-cheatsheet.netlify.app/)
- [ESLint TypeScript 규칙](https://typescript-eslint.io/rules/)

이 가이드를 따르면 타입 오류를 사전에 방지하고 일관된 코드 품질을 유지할 수 있습니다. 